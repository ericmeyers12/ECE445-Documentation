%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ECE 445 SENIOR DESIGN TEMPLATE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[letterpaper,10pt]{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The preamble starts here.
% You can add other packages that you want to use by using
% \usepackage command in the preamble.
% However, DO NOT change the settings that are already placed
% below unless you really know what you are doing.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% some commonly used packages
\usepackage{siunitx}
\usepackage{graphicx}
\usepackage{color,soul}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{setspace}
\usepackage{longtable}
\usepackage{url}
\usepackage{pdfpages}
\usepackage{float}
\usepackage{rotating}
\usepackage{caption}
\usepackage{booktabs}  % professional-looking tables
\usepackage{multicol} %used for getting multicolumn without page-break
\usepackage{multirow}	% multi-row tables
\usepackage{array}		% define column format of a table
\usepackage[colorlinks=true,linkcolor=black,citecolor=black]{hyperref}
\usepackage[top=1.1in, bottom=1.1in, left=1.1in, right=1.1in]{geometry}% set the page margins to 1 inch
\usepackage{amsmath}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

% use the fancyhdr package to maintain the format of the page numbers,
% which is useful when the text color is changed
\usepackage{fancyhdr}
\fancyhf{}
\renewcommand{\headrulewidth}{1pt}
\renewcommand{\footrulewidth}{0pt}
\fancyfoot[C]{\textcolor{black}{\thepage}}
\fancyhead[L]{\includegraphics[width=2cm]{University-of-Illinois-logo.jpg}}
\fancyhead[R]{\small{Infantry I.F.F. Final Report - Meyers \& Prince}}

% paralist provides extended list environments
\usepackage{paralist}
\setlength{\plitemsep}{0pt}

% define the color for section and subsection titles
\usepackage{xcolor}
\definecolor{titlecolor}{RGB}{31,73,125}
\definecolor{subtitlecolor}{RGB}{79,129,189}

% change the style of the section and subsection titles
\usepackage{titlesec}
\titleformat{\section}{\color{titlecolor}\Large\bf}{\color{titlecolor}\thesection}{0.8em}{}
\titleformat{\subsection}{\color{subtitlecolor}\large\bf}{\color{subtitlecolor}\thesubsection}{1em}{}
\titleformat{\subsubsection}{\color{subtitlecolor}\normalsize\bf}{\color{subtitlecolor}\thesubsubsection}{1.2em}{}
\titlespacing{\section}{0pt}{0em}{0em}
\titlespacing{\subsection}{6pt}{0em}{0em}
\titlespacing{\subsubsection}{12pt}{0em}{0em}



% change the style of the table of contents
\usepackage{titletoc}
\titlecontents{section}[1.5em]{}{\contentslabel{1.5em}}{\hspace*{-1.5em}}{\titlerule*[0.5pc]{.}\contentspage}
\titlecontents{subsection}[3em]{}{\contentslabel{2.1em}}{\hspace*{-2.1em}}{\titlerule*[0.5pc]{.}\contentspage}
\titlecontents{subsubsection}[5.1em]{}{\contentslabel{2.7em}}{\hspace*{-2.7em}}{\titlerule*[0.5pc]{.}\contentspage}

% command for centering texts in a fixed width table cell
\newcommand{\centpcol}{\leftskip\fill \rightskip\fill}

% command for setting the style of the appendix titles
\newcommand{\setappenstyle}{
	\titleformat{\section}{\color{titlecolor}\Large\bf}{\color{titlecolor}Appendix \Alph{section}}{0.8em}{}
	\titlecontents{section}[0em]{}{Appendix \thecontentslabel \hspace{1em}}{}{\titlerule*[0.5pc]{.}\contentspage}
}

\makeatletter
\newcommand{\skipitems}[1]{%
	\addtocounter{\@enumctr}{#1}%
}

% define the style of the title of the paper
\newcommand{\thetitle}[1]{\title{\begin{huge}{\bf #1}\end{huge} \color{subtitlecolor}\rule[25pt]{\textwidth}{1pt}}}

% define the style of the author
\newcommand{\theauthor}[3]{
	\author{\vspace{.4in}\\
	\textcolor{black}{By}\\
	#1
	\vspace{1in}\\
	\textcolor{black}{ECE 445 Final Report -} #2\\
	\textcolor{black}{TA:} #3
	\vspace{1in}}
}

% define the style of figure's caption
\newcommand{\figcap}[1]{
	\captionsetup{format=plain,font={small,color=subtitlecolor,singlespacing},margin={0pt,0pt}}
	\caption{\textcolor{subtitlecolor}{#1}}
	\vspace{-5pt}
}

% define the style of table's caption
\newcommand{\tablecap}[1]{
	\captionsetup{format=plain,font={bf,normalsize,singlespacing,color=black},margin={0pt,0pt}}
	\caption{\textcolor{black}{#1}}
	\vspace{-5pt}
}


\newcommand{\buildtoc}{
	\clearpage
	\singlespacing
	\tableofcontents
	\onehalfspacing
}

% set indentations and the space between paragraghs
\setlength{\parindent}{0pt}
\setlength{\parskip}{8pt}

\setcounter{secnumdepth}{4}

\titleformat{\paragraph}
{\normalfont\small\bfseries\color{subtitlecolor}}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{18pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PREAMBLE ENDS HERE, DOCUMENT STARTS BELOW
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

% don't change these
\pagestyle{empty}
\doublespacing

% put the title of your project here. DO NOT include the brackets.
\thetitle{{I.F.F. (Identification Friend or Foe) System}}

% put your names here. seperate by \\. DO NOT include the brackets.
\theauthor{
	{Eric Meyers (emeyer7)}\\
	{Noah Prince (nprince2)}\\
}
{ % put the semester info here. DO NOT include the brackets.
	{Spring 2016}
}
{ % put your TA's name here. DO NOT include the brackets.
	{Braedon Salz}
}

% put the date and project number here. DO NOT include the brackets.
\date{
{May 4th, 2016}\\
Project No. 11
\clearpage
}

% don't change these
\maketitle
\pagestyle{fancy}
\begin{spacing}{1.15}


% build the table of contents. 
\color{black}
\pagenumbering{gobble}
\section*{Abstract}
This piece of equipment will reliably determine the status of a target. FUCK I DONT KNOW. This project is a reliable method to determining the status of friendly or enemy soldiers during combat eee reduce the number of friendly fire or misfire accidents between soldiers on foot during combat. A ``friend or foe" detection 
\buildtoc
\pagenumbering{gobble}
\clearpage
\setcounter{page}{1}
\pagenumbering{arabic}

%SECTION - Introduction
\section{Introduction}
The purpose of this project is to create a system that quickly and accurately identifies friendly targets among military personnel on foot. Similar systems exist for aircraft, however not many exist for infantry.

The idea is to develop a two-way communication system so that when a soldier aims their weapon in the direction of a friendly target, they will receive notification through an LED that the target is friendly and not an enemy. Throughout this document the infantry unit with the weapon will be referred to as the ``friendly interrogator" and the target will  be referred to as the ``friendly target". 

\subsection{Objectives}
\subsubsection{Goals and Benefits}
\begin{itemize}
	\item Reduce the number of friendly fire \& misfire accidents during combat.
	\item Notify friendly personnel of friendly target when aiming in their direction.
	\item Other applications include paintball, airsoft arcade laser tag, and various recreation sports.
\end{itemize}


\subsubsection{Functions and Features}
\begin{itemize}
	\item Laser transmitter on friendly interrogator to send unique I.D.
	\item Photodiodes on friendly target detect unique I.D. and verify its signal.
	\item R.F. transmitter on friendly target to send acknowledgement back to interrogator.
	\item R.F. receiver on friendly interrogator to verify that the target is friendly.
	\item LED to indicate friendly or enemy on interrogator unit with system response of less than 190 ms (human reaction time\textsuperscript{\cite{Reaction_Times}})
\end{itemize}

These functions and features are summarized in the system block diagram shown in Figure \ref{fig:system-block-diagram}. 

\begin{figure} [H]
	\centering
	\includegraphics[scale=0.45]{System_Block_Diagram.png}
	\caption{System Block Diagram\label{fig:system-block-diagram}}
\end{figure}

The two-way communication system on both units is further divided into two one-way communication channels. The laser transmitter on board the friendly interrogator will send a signal to the photoreceivers on the friendly target. The R.F. transmitter on board the friendly target will then send acknowledgement back to the friendly interrogator. 

An important aspect of this project is encryption and ensuring an enemy cannot pose as friendly to the interrogator. This will be addressed in two ways. Both systems will contain a locally synced clock so that ...


\subsection{System Level Requirements}
Requirements are imposed on both the R.F. subsystem and the laser subsystem to accurately receive packets. From a system perspective, the requirements are as follows:
\begin{enumerate}
	\item R.F. Transmitter/Receiver - Must be able to both transmit and receive at least 90\% of 8-bit packets sent over a distance of 5 meters with a carrier frequency of 315 MHz Â± 50 MHz.
	\item Laser Transmitter/Receiver - At least 90\% of transmitted laser packets must be received by the photoreciever at 5 m.
\end{enumerate}

Requirements are also imposed on the system speed. These are 
\begin{enumerate}
	\item Speed of System - A friendly target at 5 m should be marked friendly within 190 milliseconds.
\end{enumerate}




%SECTION - DESIGN
\section{Design}

%DESIGN PROCEDURE
\subsection{Design Procedure} 
\subsubsection{Friendly Interrogator}
\hspace{5mm}\textbf{Voltage/Power Regulation} \label{section:interrogator-voltage-regulation-design-procedure}
\\ \hl{TODO}

\hspace{5mm}\textbf{Laser Transmitter} \label{section:laser-transmitter-design-procedure}\\
For safety reasons, the maximum allowable power for the laser diode is $5mW$; which registers as a Class IIIa laser. The laser diode must also fall in the visible range, so that it will trigger a person's blinking reflex before eye damage occurs. Specifically, the team will use a red ($635nm$) laser. See Section \ref{section-safety-ethics} for more on safety of the laser. 

The team used a 5 mW 635 nm laser diode to transmit the unique I.D. (as specified by the 8-pin DIP switch) to the friendly target. The laser diode, sourced by a transistor, allows for pulsing of a unique identification number at $5kHz$. The limiting factor for the $5kHz$ requirement was the processing speed of the $MSP430$ microcontroller; between every sampling of the photoreceiver, a significant amount of processing must occur. 

\hspace{5mm}\textbf{R.F. Receiver} \label{section:rf-receiver-design-procedure}
\\ \hl{TODO}

\subsubsection{Friendly Target}
\hspace{5mm}\textbf{Voltage/Power Regulation} \label{section:target-voltage-regulation-design-procedure} \\
See \ref{section:interrogator-voltage-regulation-design-procedure}

\hspace{5mm}\textbf{Laser Photoreceiver} \label{section:laser-photoreceiver-design-procedure}\\
A photodiode was chosen such that a 5kHz signal could be processed and boosted to register a value between 0 and 3.3V at a maximum distance of $30m$ from the laser source. This couples the photoreceiver requirement with the intensity of the laser diode, which is capped at $5 mW$. A detailed analysis of the choice of photodiode is in \ref{section-tolerance-analysis}

\hspace{5mm}\textbf{R.F. Transmitter} \label{section:rf-transmitter-design-procedure} \\
The requirement driving both the R.F. transmitter and receiver was the ability to broadcast and receive packets (as a pair) at the maximum distance of the project ($30m$). 
\hl{TODO: Describe some of the governing equations}


\subsubsection{System}
\hspace{5mm}\textbf{Microcontroller} \label{section:system-design-procedure}\\
The microcontroller must have enough ports to service both the R.F. boards and laser/photoreceiver inputs, have enough speed to sample and decide on a packet value received at $5kHz$, and have the ability to count seconds. A vast majority of microcontrollers fit the requirements for this design, as most come with several ports, fast processors, and a built in timer.

The design decision, then, came down to ease of use and available documentation. To this end, the team chose to use the $MSP430$ series of microcontroller. Previously, the team had tried to use $MSP432s$, but these units stopped functioning mid-design. 

Other microcontroller options, including PIC and arduino were considered. Arduino was considered overkill and low difficulty for the project, PIC more difficult to work with due to less documented proprietary systems.

FROM TEMPLATE: Discuss your design decisions for each block at the most general level: What alternative approaches tothe design are possible, which was chosen, and why is it desirable? Introduce the major design equations or other design tools used; show the general form of the circuits and describe their functions.



%DESIGN DETAILS
\subsection{Design Details}

\subsubsection{Friendly Interrogator}
\hspace{5mm}\textbf{Circuit Schematics} \label{section:interrogator-circuit-schematics-design-details}
\\ \hl{TODO}

\hspace{5mm}\textbf{PCB} \label{section:interrogator-pcb-design-details}
\\ \hl{TODO}


\subsubsection{Friendly Target}
\hspace{5mm}\textbf{Circuit Schematics} \label{section:target-circuit-schematics-design-details}
\\ \hl{TODO}

\hspace{5mm}\textbf{PCB} \label{section:target-pcb-design-details}
\\ \hl{TODO}

\hspace{5mm} \textbf{Software} \label{section:target-software-design-details}\\
Incoming transmissions are broken into two parts, where a $1$ corresponds to a high at the transmission source, and a $0$ a low: 
\begin{enumerate}
	\small
	\item \textbf{Preamble} - $10101010$ 
	\item \textbf{Packet} - An 8 digit long value representing a numerical id
\end{enumerate}

Values from the photoreceiver are analog values ranging from $0-3.3V$. Because the ambient light in the room can the photoreceiver to report $0-2V$ when receiving no light from the transmitter, an algorithm was created to decide binary values of a transmission based only on the \textit{difference} between the current analog value and the analog value $200 \mu s$ before.

\makeatletter
\def\BState{\State\hskip-\ALG@thistlm}
\makeatother

\begin{algorithm}[H]
	\caption{GetCurrentBinaryValue}\label{euclid}
	\begin{algorithmic}[1]
		\State $\textbf{Input}: \textit{currentAnalogValue},\ \textit{lastAnalogValue},\ \textit{lastBinaryValue},\ \textit{THRESHOLD}$\\
		
		\State $\textit{dif} \gets (\textit{currentAnalogValue} - \textit{lastAnalogValue})$\\\\
		
		
		//Was a 0, now a high indicates a 1
		\If {$dif > \textit{THRESHOLD}$} \\
		\quad \Return $1$\\\\

		//Was a 1, now a low indicates a 0
		\ElsIf {$dif < -\textit{THRESHOLD}$} \\
		\quad \Return $0$\\\\
		
		//No change from last value
		\Else\\
		\quad \Return \textit{lastBinaryValue}
		\EndIf
	\end{algorithmic}
\end{algorithm}

Binary values are stored in an array of length 8, since both packets and preambles are 8 bits. Because a preamble can come at any moment, an algorithm was designed both to store binary values in the array, and to always check for a preamble packet 

\begin{algorithm}[H]
	\caption{ReceivePreamble}\label{euclid}
	\begin{algorithmic}[1]
		\State $\textit{photoBinary} \gets \text{new}\ \textit{Array}(8)$
		\State $\textit{lastBinaryValue} \gets 0$
		\State $\textit{lastAnalogValue} \gets 0$
		\State $currentIndex \gets 0$\\
		
		\State \textbf{every} $200 \mu s$ \textbf{do}\\
		\quad // Store current value\\
		\quad $\textit{currentAnalogValue} \gets \text{analogReadPhotoreceiver}$\\
		\quad $\textit{currentBinaryValue} \gets \text{GetCurrentBinaryValue}(\textit{currentAnalogValue},$\\ 
		\hspace{7.65cm} $\textit{lastAnalogValue},$\\
		\hspace{7.65cm} $\textit{lastBinaryValue})$ \\
		\quad $\text{photoBinary}[\textit{currentIndex}] \gets \textit{currentBinaryValue}$\\
		\quad $\textit{currentIndex} = (\textit{currentIndex} + 1)\ \%\ 8$\\\\
		
		\quad // Check if last 8 received values make 10101010 
		\State \quad $\textit{lastEightValues} = \text{concat}(\text{photoBinary}[\textit{currentIndex}...8],\text{photoBinary}[0..\textit{currentIndex}])$ \\
		\quad \textbf{if} $\textit{lastEightValues} == 10101010$ \textbf{then}\\
		\quad \quad ReceivePacket\\
		
		\State \quad $\textit{lastBinaryValue} \gets \textit{currentBinaryValue}$
		\State \quad $\textit{lastAnalogValue} \gets \textit{currentAnalogValue}$
		\State \textbf{end}		
	\end{algorithmic}
\end{algorithm}

Once a preamble has been received, a simple algorithm is used to capture a packet
\begin{algorithm}[H]
	\caption{ReceivePacket}\label{euclid}
	\begin{algorithmic}[1]
		\State $\textit{packet} \gets \text{new}\ \textit{Array}(8)$
		\State $\textit{lastBinaryValue} \gets 0$
		\State $\textit{lastAnalogValue} \gets 0$
		\State $currentIndex \gets 0$\\
		
		\State 8 \textbf{times}, \textbf{every} $200 \mu s$ \textbf{do}\\
		\quad // Store current value\\
		\quad $\textit{currentAnalogValue} \gets \text{analogReadPhotoreceiver}$\\
		\quad $\textit{currentBinaryValue} \gets \text{GetCurrentBinaryValue}(\textit{currentAnalogValue},$\\ 
		\hspace{7.65cm} $\textit{lastAnalogValue},$\\
		\hspace{7.65cm} $\textit{lastBinaryValue})$ \\
		\quad $\text{packet}[\textit{currentIndex}] \gets \textit{currentBinaryValue}$\\
		\quad $\textit{currentIndex}\text{++}$\\\\
		
		\State \quad $\textit{lastBinaryValue} \gets \textit{currentBinaryValue}$
		\State \quad $\textit{lastAnalogValue} \gets \textit{currentAnalogValue}$
		\State \textbf{end}\\\\
		
		\Return \textit{packet}
	\end{algorithmic}
\end{algorithm}
\subsubsection{System}

FROM TEMPLATE: Present the detailed design, with diagrams and component values. Show how the design equations were applied. Give equations and diagrams with specific design values and data. Place large data tables in an appendix.Â Â Circuit diagrams that are too large to be readable on a single page should be broken into pieces for presentation.Â Â The full diagram may be included in an appendix.Â Â Use photographs only as necessary and treat them, along with all other graphics except tables, as figures.


%SECTION - VERIFICATION
\section{Verification}
\hl{INCLUDE R\&V TABLE IN APPENDIX IN BACK}
\\ \hl{TODO}
\subsection{Counting Packets}
The following algorithm was used to count the number of missed packets from the photoreceiver
\begin{algorithm}[H]
	\caption{CountMissedPackets}\label{euclid}
	\begin{algorithmic}[1]
		\State \textbf{Input}: \textit{expectedPacketValue}\\
		\State $\textit{missedPackets} \gets 0$\\
		ReceivePreambleAndPacket // Get first packet to ensure transmission started
		
		\State $100.\textbf{times}\ \textbf{do}$\\
			\quad ReceivePreambleOnce // Receive next 8 bits as preamble, ignore if not a correct preamble \\
			\quad \textbf{if} ReceivePacket $\neq$ \textit{expectedPacketValue} \textbf{then} \\
			\quad \quad \textit{missedPackets}++
		\State \textbf{end}
	\end{algorithmic}
\end{algorithm}

FROM TEMPLATE: Discuss the Requirement and Verification Table from your design review. Including the table in an appendix will help avoid lengthy and tedious narrative description in the main text, which may not be of immediate interest to your imagined audience of managers. Do not discuss lowâlevel requirements unless they failed to verify, or you found that they were critical in some unexpected way, or you need to makes changesâfor instance, to the tolerances or acceptable ranges of quantitative results. It is important to hit the main points and explain any requirement that is not verified, but keep the discussion concise and refer interested readers to the appendix for details. Note that the design procedure, design details, and design verification can be organized in different ways. The Word template provided by the ECE 445 staff puts the first two in one chapter and the second in another; however, a separate chapter for each is also common, with chapter sections reiterating the main project components. If you do the latter, avoid unnecessary repetition of component descriptions. Another option, though rarely used, is to organize the report according to components or blocks, with each chapter describing the design procedure, details, and verification for a single component or block.

%COSTS
\section{Costs}
\hl{TODO}
FROM TEMPLATE: Labor cost estimates should use the following formula for each partner:
ideal salary (hourly rate) ï´ actual hours spent ï´ 2.5 include estimates for electronics and machine shop hours, as applicable. For parts, use real values when you know them; make realistic estimates otherwise. List both the retail cost and what you or the department paid (in this case you may list labâowned pieces as free).Â Â If the project might be commercially viable, estimate the cost of massâproduction by listing bulkâpurchase costs. Make sure any tables are numbered appropriately, given titles, and cited directly in the text.Â Â 

%CONCLUSION
\section{Conclusion}
\hl{TODO}
FROM TEMPLATE: Bring together, concisely, the conclusions to be drawn. It may be appropriate, depending on the nature of the project, to begin or end with a twoâÂ or threeâsentence executive summary. The reader needs to be convinced that the design will work. Summarize your accomplishments. If uncertainties remain, they should be pointed out, and alternatives, such as modifying performance specifications, should be spelled out to deal with foreseeable outcomes. UseÂ Â words, not equations or diagrams. Devote a section to ethical considerations with reference to the IEEE Code of Ethics and any other applicable code (e.g., the AMA Code of Medical Ethics for certain bioengineering projects).

%REFERENCES
\section{References}
\hl{TODO}
FROM TEMPLATE: Follow the IEEE reference styles provided in this document for various kinds of sources. If you need to cite something for which there is no example, simply use common sense and provideâin a neat and orderly manner emulating the IEEE reference styleâthe information necessary for another researcher to find that source.Â Â  References [1]â[3] are examples of a manual, datasheet, and web page, respectively. References [4]â[7] are more standard, scholarly sources: a book, chapter in an edited book, journal article, and conference proceedings. Reference [8] is a technical report, and reference [9] is class notes. Cite all references
consecutively in the text, as is done here. (ECE Editorial Services provides a more detailed description of IEEE reference style on its wiki: http://go.illinois.edu/ecethesis .)

\clearpage
\bibliographystyle{IEEE_ECE}
% include the BibTex file here to build reference
\bibliography{Citations}\addcontentsline{toc}{section}{Reference}
\clearpage
\section*{Appendix}

\end{spacing}
\end{document}

